{"openapi":"3.0.1","info":{"title":"User Service API","description":"통신요금 관리 서비스 - 사용자 인증 및 관리 API","contact":{"name":"PhoneBill Development Team","email":"dev@phonebill.com"},"version":"1.0.0"},"servers":[{"url":"http://localhost:8081","description":"Local Development"},{"url":"{protocol}://{host}:{port}","description":"Custom Server","variables":{"protocol":{"description":"Protocol (http or https)","default":"http","enum":["http","https"]},"host":{"description":"Server host","default":"localhost"},"port":{"description":"Server port","default":"8081"}}}],"security":[{"bearerAuth":[]}],"tags":[{"name":"Authentication","description":"인증 관련 API"},{"name":"User Management","description":"사용자 관리 API"}],"paths":{"/api/v1/users/{userId}/permissions/{permissionCode}/grant":{"post":{"tags":["User Management"],"summary":"권한 부여","description":"사용자에게 특정 권한을 부여합니다.\n\n**사용 가능한 권한 코드:**\n- `BILL_INQUIRY`: 요금 조회 서비스 권한\n- `PRODUCT_CHANGE`: 상품 변경 서비스 권한\n- `ADMIN`: 관리자 권한\n- `USER_MANAGEMENT`: 사용자 관리 권한","operationId":"grantPermission","parameters":[{"name":"userId","in":"path","description":"사용자 ID","required":true,"schema":{"type":"string"}},{"name":"permissionCode","in":"path","description":"권한 코드","required":true,"schema":{"type":"string"},"example":"BILL_INQUIRY"},{"name":"grantedBy","in":"query","description":"권한 부여자","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"권한 부여 성공","content":{"*/*":{"schema":{"type":"string"}}}},"400":{"description":"잘못된 요청","content":{"*/*":{"schema":{"type":"string"}}}},"404":{"description":"사용자 또는 권한을 찾을 수 없음","content":{"*/*":{"schema":{"type":"string"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"type":"string"}}}}}}},"/api/v1/auth/unlock/{userId}":{"post":{"tags":["Authentication"],"summary":"계정 잠금 해제","description":"잠겨있는 사용자 계정의 잠금을 해제합니다. (관리자 권한 필요)","operationId":"unlockAccount","parameters":[{"name":"userId","in":"path","description":"사용자 ID","required":true,"schema":{"type":"string"}}],"responses":{"404":{"description":"사용자를 찾을 수 없음","content":{"*/*":{"schema":{"type":"string"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"type":"string"}}}},"200":{"description":"잠금 해제 성공","content":{"*/*":{"schema":{"type":"string"}}}}}}},"/api/v1/auth/register":{"post":{"tags":["Authentication"],"summary":"사용자 등록","description":"새로운 사용자를 등록하고 지정된 권한을 부여합니다.","operationId":"registerUser","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserRegistrationRequest"}}},"required":true},"responses":{"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserRegistrationResponse"}}}},"200":{"description":"사용자 등록 성공","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserRegistrationResponse"}}}},"400":{"description":"잘못된 요청 (입력값 검증 실패 또는 중복 데이터)","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserRegistrationResponse"}}}}}}},"/api/v1/auth/refresh":{"post":{"tags":["Authentication"],"summary":"토큰 갱신","description":"Refresh Token을 사용하여 새로운 Access Token과 Refresh Token을 발급받습니다.","operationId":"refreshToken","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenRequest"}}},"required":true},"responses":{"200":{"description":"토큰 갱신 성공","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RefreshTokenResponse"}}}},"400":{"description":"잘못된 요청","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RefreshTokenResponse"}}}},"401":{"description":"유효하지 않은 Refresh Token","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RefreshTokenResponse"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"$ref":"#/components/schemas/RefreshTokenResponse"}}}}}}},"/api/v1/auth/logout":{"post":{"tags":["Authentication"],"summary":"사용자 로그아웃","description":"Authorization Header의 JWT 토큰에서 사용자 정보를 추출하여 현재 세션을 종료하고 Refresh Token을 무효화합니다.","operationId":"logout","responses":{"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"type":"string"}}}},"401":{"description":"유효하지 않은 토큰","content":{"*/*":{"schema":{"type":"string"}}}},"200":{"description":"로그아웃 성공","content":{"*/*":{"schema":{"type":"string"}}}}}}},"/api/v1/auth/login":{"post":{"tags":["Authentication"],"summary":"사용자 로그인","description":"사용자 ID와 비밀번호로 로그인하여 JWT 토큰을 발급받습니다.","operationId":"login","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"로그인 성공","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"401":{"description":"인증 실패 (잘못된 사용자 ID 또는 비밀번호)","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"400":{"description":"잘못된 요청 (입력값 검증 실패)","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}},"423":{"description":"계정 잠금","content":{"*/*":{"schema":{"$ref":"#/components/schemas/LoginResponse"}}}}}}},"/api/v1/auth/change-password":{"post":{"tags":["Authentication"],"summary":"비밀번호 변경","description":"현재 비밀번호를 확인하고 새로운 비밀번호로 변경합니다. 변경 후 모든 세션이 무효화됩니다.","operationId":"changePassword","parameters":[{"name":"userId","in":"query","description":"사용자 ID","required":true,"schema":{"type":"string"}},{"name":"currentPassword","in":"query","description":"현재 비밀번호","required":true,"schema":{"type":"string"}},{"name":"newPassword","in":"query","description":"새 비밀번호","required":true,"schema":{"type":"string"}}],"responses":{"401":{"description":"현재 비밀번호가 올바르지 않음","content":{"*/*":{"schema":{"type":"string"}}}},"400":{"description":"잘못된 요청","content":{"*/*":{"schema":{"type":"string"}}}},"404":{"description":"사용자를 찾을 수 없음","content":{"*/*":{"schema":{"type":"string"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"type":"string"}}}},"200":{"description":"비밀번호 변경 성공","content":{"*/*":{"schema":{"type":"string"}}}}}}},"/api/v1/users":{"get":{"tags":["User Management"],"summary":"모든 사용자 정보 조회","description":"등록된 모든 사용자의 정보를 조회합니다.","operationId":"getAllUsers","responses":{"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserInfoResponse"}}}}},"200":{"description":"조회 성공","content":{"*/*":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/UserInfoResponse"}}}}}}}},"/api/v1/users/{userId}":{"get":{"tags":["User Management"],"summary":"사용자 정보 조회","description":"사용자 ID로 사용자의 기본 정보를 조회합니다.","operationId":"getUserInfo","parameters":[{"name":"userId","in":"path","description":"사용자 ID","required":true,"schema":{"type":"string"}}],"responses":{"404":{"description":"사용자를 찾을 수 없음","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}},"200":{"description":"조회 성공","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}}}}},"/api/v1/users/by-line/{lineNumber}":{"get":{"tags":["User Management"],"summary":"회선번호로 사용자 정보 조회","description":"회선번호로 해당 회선의 사용자 정보를 조회합니다.","operationId":"getUserInfoByLineNumber","parameters":[{"name":"lineNumber","in":"path","description":"회선번호","required":true,"schema":{"type":"string"}}],"responses":{"404":{"description":"사용자를 찾을 수 없음","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}},"200":{"description":"조회 성공","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}}}}},"/api/v1/users/by-customer/{customerId}":{"get":{"tags":["User Management"],"summary":"고객 ID로 사용자 정보 조회","description":"고객 ID로 해당 고객의 사용자 정보를 조회합니다.","operationId":"getUserInfoByCustomerId","parameters":[{"name":"customerId","in":"path","description":"고객 ID","required":true,"schema":{"type":"string"}}],"responses":{"404":{"description":"사용자를 찾을 수 없음","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}},"200":{"description":"조회 성공","content":{"*/*":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}}}}},"/api/v1/auth/verify":{"get":{"tags":["Authentication"],"summary":"토큰 검증","description":"JWT 토큰의 유효성을 검증하고 토큰 정보를 반환합니다.","operationId":"verifyToken","parameters":[{"name":"token","in":"query","description":"검증할 JWT 토큰","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"토큰 검증 완료","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TokenVerifyResponse"}}}},"400":{"description":"잘못된 요청","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TokenVerifyResponse"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"$ref":"#/components/schemas/TokenVerifyResponse"}}}}}}},"/api/v1/auth/health":{"get":{"tags":["Authentication"],"summary":"인증 서비스 헬스 체크","description":"인증 서비스의 상태를 확인합니다.","operationId":"healthCheck","responses":{"200":{"description":"서비스 정상","content":{"*/*":{"schema":{"type":"string"}}}}}}},"/api/v1/users/{userId}/permissions/{permissionCode}":{"delete":{"tags":["User Management"],"summary":"권한 철회","description":"사용자의 특정 권한을 철회합니다.\n\n**사용 가능한 권한 코드:**\n- `BILL_INQUIRY`: 요금 조회 서비스 권한\n- `PRODUCT_CHANGE`: 상품 변경 서비스 권한\n- `ADMIN`: 관리자 권한\n- `USER_MANAGEMENT`: 사용자 관리 권한","operationId":"revokePermission","parameters":[{"name":"userId","in":"path","description":"사용자 ID","required":true,"schema":{"type":"string"}},{"name":"permissionCode","in":"path","description":"권한 코드","required":true,"schema":{"type":"string"},"example":"BILL_INQUIRY"}],"responses":{"400":{"description":"잘못된 요청","content":{"*/*":{"schema":{"type":"string"}}}},"404":{"description":"사용자 또는 권한을 찾을 수 없음","content":{"*/*":{"schema":{"type":"string"}}}},"500":{"description":"서버 내부 오류","content":{"*/*":{"schema":{"type":"string"}}}},"200":{"description":"권한 철회 성공","content":{"*/*":{"schema":{"type":"string"}}}}}}}},"components":{"schemas":{"UserRegistrationRequest":{"required":["customerId","lineNumber","password","permissions","userId","userName"],"type":"object","properties":{"userId":{"maxLength":20,"minLength":3,"pattern":"^[a-zA-Z0-9_-]+$","type":"string","description":"사용자 ID","example":"mvno001"},"customerId":{"maxLength":20,"minLength":0,"type":"string","description":"고객 ID","example":"CU202401001"},"lineNumber":{"pattern":"^010-\\d{4}-\\d{4}$","type":"string","description":"회선번호","example":"010-1234-5678"},"userName":{"maxLength":50,"minLength":0,"type":"string","description":"사용자 이름","example":"홍길동"},"password":{"maxLength":50,"minLength":8,"pattern":"^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$","type":"string","description":"비밀번호","example":"securePassword123!"},"permissions":{"type":"array","description":"권한 목록","example":["BILL_INQUIRY","PRODUCT_CHANGE"],"items":{"type":"string","description":"권한 목록","example":"[\"BILL_INQUIRY\",\"PRODUCT_CHANGE\"]"}}},"description":"사용자 등록 요청 정보"},"UserData":{"type":"object","properties":{"userId":{"type":"string","description":"사용자 ID","example":"mvno001"},"customerId":{"type":"string","description":"고객 ID","example":"CU202401001"},"lineNumber":{"type":"string","description":"회선번호","example":"010-1234-5678"},"userName":{"type":"string","description":"사용자 이름","example":"홍길동"},"accountStatus":{"type":"string","description":"계정 상태","example":"ACTIVE"},"createdAt":{"type":"string","description":"등록 시간","format":"date-time"},"permissions":{"type":"array","description":"부여된 권한 목록","example":["BILL_INQUIRY","PRODUCT_CHANGE"],"items":{"type":"string","description":"부여된 권한 목록","example":"[\"BILL_INQUIRY\",\"PRODUCT_CHANGE\"]"}}},"description":"등록된 사용자 데이터"},"UserRegistrationResponse":{"type":"object","properties":{"success":{"type":"boolean","description":"응답 성공 여부","example":true},"message":{"type":"string","description":"응답 메시지","example":"사용자가 성공적으로 등록되었습니다"},"data":{"$ref":"#/components/schemas/UserData"}},"description":"사용자 등록 응답"},"RefreshTokenRequest":{"required":["refreshToken"],"type":"object","properties":{"refreshToken":{"type":"string"}},"description":"토큰 갱신 요청"},"RefreshTokenResponse":{"type":"object","properties":{"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"tokenType":{"type":"string"},"expiresIn":{"type":"integer","format":"int32"}}},"LoginRequest":{"required":["password","userId"],"type":"object","properties":{"autoLogin":{"type":"boolean"},"userId":{"maxLength":20,"minLength":3,"pattern":"^[a-zA-Z0-9_-]+$","type":"string"},"password":{"maxLength":50,"minLength":8,"type":"string"}},"description":"로그인 요청 정보"},"LoginResponse":{"type":"object","properties":{"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"tokenType":{"type":"string"},"expiresIn":{"type":"integer","format":"int32"},"userId":{"type":"string"},"customerId":{"type":"string"},"lineNumber":{"type":"string"},"user":{"$ref":"#/components/schemas/UserInfo"}}},"UserInfo":{"type":"object","properties":{"userId":{"type":"string"},"userName":{"type":"string"},"phoneNumber":{"type":"string"},"permissions":{"type":"array","items":{"type":"string"}}}},"UserInfoResponse":{"type":"object","properties":{"userId":{"type":"string"},"customerId":{"type":"string"},"lineNumber":{"type":"string"},"userName":{"type":"string"},"status":{"type":"string"},"accountStatus":{"type":"string"},"lastLoginAt":{"type":"string","format":"date-time"},"lastPasswordChangedAt":{"type":"string","format":"date-time"},"permissions":{"type":"array","items":{"type":"string"}}}},"TokenVerifyResponse":{"type":"object","properties":{"valid":{"type":"boolean"},"userId":{"type":"string"},"customerId":{"type":"string"},"lineNumber":{"type":"string"},"expiresAt":{"type":"string","format":"date-time"},"message":{"type":"string"}}}},"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}}}}